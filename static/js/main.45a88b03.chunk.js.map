{"version":3,"sources":["utils/getSecret.js","components/Title.js","strings.js","utils/translate.js","styles.js","routes/CreateRoom.js","routes/EditRoom.js","utils/onInputChange.js","components/Loader.js","utils/animals.js","contexts/RoomAuth.js","routes/JoinRoom.js","components/List.js","routes/ListRooms.js","components/withAuthorizedRoom.js","components/Unescape.js","contexts/FavoriteSongs.js","components/FavoriteToggle.js","components/YouTubeThumbnail.js","utils/constants.js","components/SongListItem.js","components/SongList.js","components/RoomControls.js","routes/ViewRoom.js","components/SongSearchListItem.js","components/SongSearchResults.js","routes/SearchSongs.js","routes/FavoriteSongs.js","components/LinkSegmentControl.js","routes/AddSong.js","components/OnMouseMove.js","components/ProgressCircle.js","services/segue.js","services/video.js","utils/parseQuerySnapshot.js","services/player.js","services/commands.js","services/karaoke.js","services/songs.js","routes/DisplayRoom.js","routes/index.js","components/Header.js","App.js","index.js"],"names":["configByLocalStorageKey","queryParams","URLSearchParams","window","location","search","localStorageKey","envKey","queryParamKey","forEach","config","param","get","localStorage","setItem","getSecret","Error","localVar","getItem","envVar","process","containerCss","css","textCss","Title","text","children","appTitle","cancel","next","songsEmptySet","roomAddSong","roomAddFavorite","roomTvView","songSearch","createRoomTitle","addSongTitle","searchLabel","searchButton","joinRoomTitle","roomName","joinRoomName","joinRoomPassword","joinRoomButton","animalName","animal","favoritesTitle","favoritesEmpty","addRoomLink","favoritesLink","searchLink","play","pause","nextSong","exitRoom","translate","key","params","string","strings","listBorder","commonButtonMixin","listItemMixin","leftOffset","paddingTop","titleLinkCss","titleLinkCancelCss","withFirestore","firestore","useState","name","setName","password","setPassword","history","useHistory","redirectToRoom","roomId","push","sendPublicRoomListing","collection","add","sortKey","toLowerCase","then","catch","error","t","to","onSubmit","e","data","preventDefault","trim","results","id","onChange","target","value","type","EditRoom","onInputChange","setter","Loader","RoomAuth","createContext","getRoomAuth","setRoomAuth","ani","animals","Math","floor","random","length","randomAnimalName","JoinRoom","useContext","RoomAuthContext","useParams","nameInputRef","useRef","passwordInputRef","useEffect","nameInput","current","passwordInput","focus","filter","path","render","isLoading","ref","styled","ul","listItemCss","linkCss","RoomListItem","ListRooms","List","map","sort","withAuthorizedRoom","Component","props","currentId","currentPassword","redirect","firebase","FieldPath","documentId","room","Unescape","dangerouslySetInnerHTML","__html","KEY","songs","JSON","parse","saveSongs","obj","stringify","FavoriteSongs","addSong","ytId","title","removeSong","hasSong","mapSongs","fn","Object","keys","index","songCount","divCss","buttonCss","FavoriteToggle","FavoriteSongsContext","isFav","setIsFav","onClick","color","imgCss","YouTubeThumbnail","width","url","alt","aria-hidden","height","src","defaultProps","liCss","numberCss","textContainerCss","SongListItem","singer","command","event","snapshot","docs","doc","delete","created","Date","now","spanCss","buildFetchRequest","query","trimmedQuery","escapedQuery","encodeURI","apiKey","headers","Accept","items","connect","resultsFetch","pending","rejected","fulfilled","videoId","snippet","SearchSongs","inputRef","setQuery","submittedQuery","setSubmittedQuery","input","SongSearchResults","listCss","notCurrentLinkCss","currentLinkCss","Segment","label","useRouteMatch","exact","LinkSegmentControl","routes","OnMouseMove","bounceDuration","sleepDuration","didMove","setDidMove","bounceTimeout","setBounceTimeout","isSleeping","setIsSleeping","onMove","useCallback","setTimeout","clearTimeout","addEventListener","removeEventListener","ProgressCircle","percent","radius","strokeWidth","secondaryColor","primaryColor","diameter","perimeter","PI","style","transform","viewBox","xmlns","cx","cy","fill","r","stroke","strokeDasharray","strokeDashoffset","min","transition","Machine","initial","context","limit","elapsed","stepDate","states","playing","entry","exit","after","200","on","cond","PAUSE","paused","PLAY","done","actions","setStepDate","assign","incrementElapsed","updateProgress","sendParent","guards","limitExceeded","player","start","buffering","PLAYER_PLAYING","PLAYER_PAUSED","playVideo","pauseVideo","STATES","onEvent","onStateChange","onError","update","commands","parseQuerySnapshot","onSnapshot","CONFIG","currentSong","segueProgress","loading","READY","_","forwardTo","segue","invoke","onDone","NEXT_SONG","SEGUE_PROGRESS","video","PLAYER_ENDED","PLAYER_ERROR","PLAYER_BUFFERING","empty","1000","UPDATE_SONGS","DONE","playerMachine","songCollection","songQuery","orderBy","commandQuery","shiftSong","shift","cueVideo","cueVideoById","clearVideo","getVideoData","services","segueMachine","videoMachine","playerService","commandsService","styles","position","top","bottom","left","right","cover","screen","background","display","flexDirection","alignItems","justifyContent","segueSinger","fontWeight","fontSize","whiteSpace","paddingRight","paddingLeft","textOverflow","textAlign","segueSong","padding","marquee","overflow","margin","listStyleType","marqueeItem","marginLeft","progress","substate","transformOrigin","opacity","controlPanel","isVisible","button","border","marginTop","marginRight","cursor","textDecoration","fontFamily","outline","iframeParams","controls","disablekb","enablejsapi","modestbranding","CreateRoom","ViewRoom","useMachine","karaokeMachine","send","service","state","submachine","onKeyDown","YouTube","className","containerClassName","onReady","opts","role","aria-label","AddSong","Header","App","projectId","initializeApp","auth","signInAnonymously","ReactDOM","document","getElementById"],"mappings":"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AK,OACLD,MAAO5B,KAGX,qCAEE,qBACE0B,SAAU,SAAAN,GAAC,OAAIjB,EAAYiB,EAAEO,OAAOC,QACpCC,KAAK,OACLD,MAAO1B,KAGX,yCC3EO4B,EAJE,WACf,OAAO,kBAAC,EAAD,CAAO3E,KAAK,qBCDN4E,EAJO,SAAAC,GAAM,OAAI,SAAAZ,GAC9BY,EAAOZ,EAAEO,OAAOC,SCIHK,EAJA,WACb,OAAO,0CCFM,GACb,WACA,SACA,WACA,WACA,YACA,SACA,MACA,OACA,SACA,SACA,QACA,SACA,UACA,YACA,QACA,WACA,UACA,MACA,UACA,UACA,aACA,WACA,SACA,MACA,OACA,OACA,aACA,OACA,QACA,MACA,SACA,UACA,OACA,UACA,WACA,MACA,SACA,WACA,MACA,QACA,SACA,UACA,OACA,QACA,UACA,YACA,OACA,WACA,QACA,QACA,QACA,OACA,SACA,SACA,WACA,QACA,UACA,UACA,QACA,UACA,OACA,SACA,QACA,OACA,UACA,UACA,WACA,UACA,WACA,SACA,QACA,UACA,SACA,UACA,YACA,OACA,QACA,MACA,KACA,QACA,WACA,UACA,UACA,MACA,WACA,YACA,WACA,cACA,SACA,UACA,QACA,OACA,UACA,QACA,QACA,QACA,QACA,QACA,WACA,UACA,QACA,QACA,WACA,SACA,SACA,UACA,SACA,UACA,SACA,aACA,OACA,YACA,SACA,YACA,MACA,SC5FaC,EAFEC,wBAAc,CAAEC,YANb,iBAAO,CACzBpC,KAAMzD,aAAaK,QAAQ,cAC3B6E,GAAIlF,aAAaK,QAAQ,UACzBsD,SAAU3D,aAAaK,QAAQ,kBAGayF,YAZ1B,SAACrC,EAAMyB,EAAIvB,GAC7B3D,aAAaC,QAAQ,aAAcwD,EAAKuB,QANjB,WACvB,IAAMe,EAAMC,EAAQC,KAAKC,MAAMD,KAAKE,SAAWH,EAAQI,SACvD,OAAO1B,EAAE,aAAcqB,GAI2BM,IAClDrG,aAAaC,QAAQ,SAAUiF,GAC/BlF,aAAaC,QAAQ,eAAgB0D,MCwExB2C,EA3EE,WAAO,IAAD,EACgBC,qBAAWC,GAAxCX,EADa,E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","file":"static/js/main.45a88b03.chunk.js","sourcesContent":["const SECRETS_CONFIG = [\n  {\n    localStorageKey: 'firebaseApiKey',\n    envKey: 'REACT_APP_FIREBASE_API_KEY',\n    queryParamKey: 'a',\n  },\n  {\n    localStorageKey: 'firebaseProjectId',\n    envKey: 'REACT_APP_FIREBASE_PROJECT_ID',\n    queryParamKey: 'b',\n  },\n  {\n    localStorageKey: 'youtubeApiKey',\n    envKey: 'REACT_APP_YOUTUBE_API_KEY',\n    queryParamKey: 'c',\n  },\n];\n\nconst configByLocalStorageKey = {};\nconst queryParams = new URLSearchParams(window.location.search);\n\n// Allow secrets to be defined in either `localStorage` or `.env.local`.\n// If a secret can't be found, raise an exception.\n// This allows the app to run remotely without requiring a backend to host the secrets.\nconst getSecret = localStorageKey => {\n  const config = configByLocalStorageKey[localStorageKey];\n\n  if (!config) {\n    throw new Error(\n      `\"${localStorageKey}\" is not defined in the SECRETS_CONFIG.`\n    );\n  }\n\n  const { envKey, queryParamKey } = config;\n  const localVar = localStorage.getItem(localStorageKey);\n  const envVar = process.env[envKey];\n\n  if (localVar) {\n    return localVar;\n  }\n\n  if (envVar) {\n    return envVar;\n  }\n\n  throw new Error(\n    `\"${localStorageKey}\" must be defined in localStorage, \"${queryParamKey}\" must be defined in the query string, or \"${envKey}\" must be defined as an environment variable.`\n  );\n};\n\nSECRETS_CONFIG.forEach(config => {\n  const { localStorageKey, queryParamKey } = config;\n\n  // When the app first loads, save any secrets to localStorage\n  // that are defined in query params.\n  const param = queryParams.get(queryParamKey);\n  if (param) {\n    localStorage.setItem(localStorageKey, param);\n  }\n\n  // Create a dictionary of secrets by their localStorage key,\n  // which is how they will be referenced in the rest of the app.\n  configByLocalStorageKey[localStorageKey] = config;\n});\n\nexport default getSecret;\n","/** @jsx jsx */\n\nimport { css, jsx } from '@emotion/core';\n\nconst containerCss = css`\n  padding: 15px;\n  display: flex;\n  justify-content: space-between;\n  align-items: baseline;\n`;\n\nconst textCss = css`\n  font-weight: 600;\n  font-size: 20px;\n  display: block;\n  line-height: 1.3;\n  margin: 0;\n`;\n\nconst Title = ({ text, children }) => (\n  <div css={containerCss}>\n    <h2 css={textCss}>{text}</h2>\n    {children}\n  </div>\n);\n\nexport default Title;\n","export default {\n  appTitle: 'Untitled Karaoke App',\n  cancel: 'Cancel',\n  next: 'Next',\n  songsEmptySet: 'Your playlist is empty.',\n  roomAddSong: 'Add Song',\n  roomAddFavorite: 'Add favorite',\n  roomTvView: 'TV mode',\n  songSearch: 'Search Videos',\n  createRoomTitle: 'Create Room',\n  addSongTitle: 'Add Song to Queue',\n  searchLabel: 'Search YouTube videos',\n  searchButton: 'Search',\n  joinRoomTitle: roomName => `Join ${roomName}`,\n  joinRoomName: 'Name',\n  joinRoomPassword: 'Password',\n  joinRoomButton: 'Join',\n  animalName: animal => `Anonymous ${animal}`,\n  favoritesTitle: 'Favorites',\n  favoritesEmpty: \"You don't have any favorite videos.\",\n  addRoomLink: 'Create Room',\n  favoritesLink: 'Favorites',\n  searchLink: 'Search',\n  play: 'Play Song',\n  pause: 'Pause Song',\n  nextSong: 'Next Song',\n  exitRoom: 'Exit Room',\n};\n","import strings from '../strings';\n\nconst translate = (key, params) => {\n  let string = null;\n\n  if (params) {\n    if (typeof strings[key] === 'function') {\n      string = strings[key](params);\n    } else {\n      throw new Error(\n        `The string \"${key}\" must be a function when called with a second argument.`\n      );\n    }\n  } else {\n    string = strings[key];\n  }\n\n  if (string) {\n    return string;\n  } else {\n    throw new Error(`The string \"${key}\" could not be found.`);\n  }\n};\n\nexport default translate;\n","import { css } from '@emotion/core';\n\nexport const hoverColor = '#333';\nexport const linkColor = '#3af';\nexport const cancelColor = '#999';\n\nexport const listBorder = `1px solid #333`;\n\nexport const commonButtonMixin = css`\n  border: none;\n  cursor: pointer;\n\n  &:hover {\n    background: ${hoverColor};\n  }\n`;\n\nexport const listItemMixin = (leftOffset = 0, paddingTop = '1px') => css`\n  position: relative;\n\n  & + & {\n    padding-top: ${paddingTop};\n\n    &:before {\n      content: '';\n      display: block;\n      position: absolute;\n      left: ${leftOffset};\n      top: 0;\n      right: 0;\n      border-top: ${listBorder};\n    }\n  }\n`;\n\nexport const titleLinkCss = css`\n  color: ${linkColor};\n  font-size: 18px;\n  font-weight: bold;\n  text-decoration: none;\n  margin-left: 15px;\n  text-align: right;\n  white-space: nowrap;\n\n  &:hover {\n    text-decoration: underline;\n  }\n`;\n\nexport const titleLinkCancelCss = css`\n  ${titleLinkCss}\n  color: ${cancelColor};\n`;\n","/** @jsx jsx */\n\nimport { jsx } from '@emotion/core';\nimport { Link, useHistory } from 'react-router-dom';\nimport { Fragment, useState } from 'react';\nimport { withFirestore } from 'react-firestore';\n\nimport Title from '../components/Title';\nimport t from '../utils/translate';\nimport { titleLinkCancelCss } from '../styles';\n\nconst CreateRoom = ({ firestore }) => {\n  const [name, setName] = useState('');\n  const [password, setPassword] = useState('');\n  const history = useHistory();\n\n  const redirectToRoom = roomId => {\n    history.push(`/room/${roomId}`);\n  };\n\n  const sendRoomListing = data => {\n    return firestore\n      .collection('rooms')\n      .add(data)\n      .then(function(results) {\n        return { roomId: results.id, roomName: data.name };\n      })\n      .catch(function(error) {\n        throw new Error(`Error writing document: ${name}`, error);\n      });\n  };\n\n  const sendPublicRoomListing = ({ roomId, roomName }) => {\n    return firestore\n      .collection('publicRoomListings')\n      .add({\n        roomId,\n        roomName,\n        sortKey: roomName.toLowerCase(),\n      })\n      .then(function() {\n        return roomId;\n      })\n      .catch(function(error) {\n        throw new Error(`Error writing document: ${roomName}`, error);\n      });\n  };\n\n  const normalizeInput = () => {\n    return { name: name.trim(), password };\n  };\n\n  const onFormSubmit = e => {\n    e.preventDefault();\n    sendRoomListing(normalizeInput())\n      .then(sendPublicRoomListing)\n      .then(redirectToRoom);\n  };\n\n  return (\n    <Fragment>\n      <Title text={t('createRoomTitle')}>\n        <Link css={titleLinkCancelCss} to={`/`}>\n          {t('cancel')}\n        </Link>\n      </Title>\n      <form onSubmit={onFormSubmit}>\n        <label>\n          Name:\n          <input\n            onChange={e => setName(e.target.value)}\n            type=\"text\"\n            value={name}\n          />\n        </label>\n        <label>\n          Password:\n          <input\n            onChange={e => setPassword(e.target.value)}\n            type=\"text\"\n            value={password}\n          />\n        </label>\n        <button>Submit</button>\n      </form>\n    </Fragment>\n  );\n};\n\nexport default withFirestore(CreateRoom);\n","import React from 'react';\n\nimport Title from '../components/Title';\n\nconst EditRoom = () => {\n  return <Title text=\"TODO: Edit Room\" />;\n};\n\nexport default EditRoom;\n","const onInputChange = setter => e => {\n  setter(e.target.value);\n};\n\nexport default onInputChange;\n","import React from 'react';\nconst Loader = () => {\n  return <p>Loading...</p>;\n};\n\nexport default Loader;\n","export default [\n  'Aardvark',\n  'Alpaca',\n  'Anteater',\n  'Antelope',\n  'Armadillo',\n  'Baboon',\n  'Bat',\n  'Bear',\n  'Beaver',\n  'Beetle',\n  'Bison',\n  'Bobcat',\n  'Buffalo',\n  'Butterfly',\n  'Camel',\n  'Capybara',\n  'Caribou',\n  'Cat',\n  'Cheetah',\n  'Chicken',\n  'Chimpanzee',\n  'Chipmunk',\n  'Coyote',\n  'Cow',\n  'Crab',\n  'Crow',\n  'Cuttlefish',\n  'Deer',\n  'Dingo',\n  'Dog',\n  'Donkey',\n  'Dolphin',\n  'Duck',\n  'Echidna',\n  'Elephant',\n  'Elk',\n  'Ferret',\n  'Flamingo',\n  'Fox',\n  'Gecko',\n  'Gibbon',\n  'Giraffe',\n  'Goat',\n  'Goose',\n  'Gorilla',\n  'Groundhog',\n  'Hare',\n  'Hedgehog',\n  'Hippo',\n  'Horse',\n  'Hyena',\n  'Ibex',\n  'Impala',\n  'Jaguar',\n  'Kangaroo',\n  'Koala',\n  'Ladybug',\n  'Lemming',\n  'Lemur',\n  'Leopard',\n  'Lion',\n  'Lizard',\n  'Llama',\n  'Lynx',\n  'Mallard',\n  'Manatee',\n  'Mandrill',\n  'Meerkat',\n  'Mongoose',\n  'Monkey',\n  'Moose',\n  'Narwhal',\n  'Ocelot',\n  'Opossum',\n  'Orangutan',\n  'Oryx',\n  'Otter',\n  'Owl',\n  'Ox',\n  'Panda',\n  'Pangolin',\n  'Penguin',\n  'Pidgeon',\n  'Pig',\n  'Platypus',\n  'Porcupine',\n  'Porpoise',\n  'Prairie Dog',\n  'Rabbit',\n  'Raccoon',\n  'Rhino',\n  'Seal',\n  'Seagull',\n  'Sheep',\n  'Skunk',\n  'Sloth',\n  'Snail',\n  'Squid',\n  'Squirrel',\n  'Tamarin',\n  'Tapir',\n  'Tiger',\n  'Tortoise',\n  'Turkey',\n  'Turtle',\n  'Wallaby',\n  'Walrus',\n  'Warthog',\n  'Weasel',\n  'Wildebeest',\n  'Wolf',\n  'Wolverine',\n  'Wombat',\n  'Woodchuck',\n  'Yak',\n  'Zebra',\n];\n","import { createContext } from 'react';\n\nimport animals from '../utils/animals';\nimport t from '../utils/translate';\n\nconst randomAnimalName = () => {\n  const ani = animals[Math.floor(Math.random() * animals.length)];\n  return t('animalName', ani);\n};\n\nconst setRoomAuth = (name, id, password) => {\n  localStorage.setItem('singerName', name.trim() || randomAnimalName());\n  localStorage.setItem('roomID', id);\n  localStorage.setItem('roomPassword', password);\n};\n\nconst getRoomAuth = () => ({\n  name: localStorage.getItem('singerName'),\n  id: localStorage.getItem('roomID'),\n  password: localStorage.getItem('roomPassword'),\n});\n\nconst RoomAuth = createContext({ getRoomAuth, setRoomAuth });\n\nexport default RoomAuth;\n","import React, { useState, useContext, useRef, useEffect } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\nimport { FirestoreCollection } from 'react-firestore';\nimport onInputChange from '../utils/onInputChange';\nimport t from '../utils/translate';\n\nimport Loader from '../components/Loader';\nimport Title from '../components/Title';\nimport RoomAuthContext from '../contexts/RoomAuth';\n\nconst JoinRoom = () => {\n  const { getRoomAuth, setRoomAuth } = useContext(RoomAuthContext);\n  // Begin with the user's previously entered name already filled.\n  const [name, setName] = useState(getRoomAuth().name || '');\n  const [password, setPassword] = useState('');\n  const { id } = useParams();\n  const history = useHistory();\n  const nameInputRef = useRef(null);\n  const passwordInputRef = useRef(null);\n\n  // When the form is submitted, set the authorized room's ID and password.\n  // If the user got the password wrong, they'll be redirected to this form again.\n  const onSubmit = e => {\n    e.preventDefault();\n    setRoomAuth(name, id, password);\n    history.push(`/room/${id}`);\n  };\n\n  // When the form is rendered,\n  // If the user has already entered a name, focus the password input first.\n  // Otherwise, focus the name input first.\n  useEffect(() => {\n    const { current: nameInput } = nameInputRef;\n    const { current: passwordInput } = passwordInputRef;\n    if (nameInput && passwordInput) {\n      if (name) {\n        nameInput.focus();\n      } else {\n        passwordInput.focus();\n      }\n    }\n  }, [nameInputRef, passwordInputRef]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return (\n    <FirestoreCollection\n      filter={['roomId', '==', id]}\n      path={'publicRoomListings'}\n      render={({ isLoading, data }) => {\n        if (isLoading) {\n          return <Loader />;\n        }\n\n        const roomName = data[0].roomName;\n\n        return (\n          <>\n            <Title text={t('joinRoomTitle', roomName)} />\n            <form onSubmit={onSubmit}>\n              <label>\n                <span>{t('joinRoomName')}</span>\n                <input\n                  onChange={onInputChange(setName)}\n                  ref={nameInputRef}\n                  type=\"text\"\n                  value={name}\n                />\n              </label>\n              <label>\n                <span>{t('joinRoomPassword')}</span>\n                <input\n                  onChange={onInputChange(setPassword)}\n                  ref={passwordInputRef}\n                  type=\"text\"\n                  value={password}\n                />\n              </label>\n              <button>{t('joinRoomButton')}</button>\n            </form>\n          </>\n        );\n      }}\n    />\n  );\n};\n\nexport default JoinRoom;\n","import styled from '@emotion/styled';\nimport { listBorder } from '../styles';\n\nexport default styled.ul`\n  list-style-type: none;\n  border-top: ${listBorder};\n  border-bottom: ${listBorder};\n  margin: 0;\n  padding: 0;\n  max-width: 100vw;\n  overflow: hidden;\n`;\n","/** @jsx jsx */\n\nimport { Fragment } from 'react';\nimport { css, jsx } from '@emotion/core';\nimport { Link } from 'react-router-dom';\nimport { FirestoreCollection } from 'react-firestore';\n\nimport Title from '../components/Title';\nimport Loader from '../components/Loader';\nimport List from '../components/List';\nimport t from '../utils/translate';\nimport { commonButtonMixin, listItemMixin, titleLinkCss } from '../styles';\n\nconst listItemCss = listItemMixin('15px');\n\nconst linkCss = css`\n  ${commonButtonMixin}\n  padding: 15px 15px;\n  display: block;\n  color: #fff;\n  text-decoration: none;\n`;\n\nconst RoomListItem = ({ id, roomName, roomId }) => (\n  <li css={listItemCss} key={id}>\n    <Link css={linkCss} to={`/room/${roomId}`}>\n      {roomName}\n    </Link>\n  </li>\n);\n\nconst ListRooms = () => (\n  <Fragment>\n    <Title text=\"Rooms\">\n      <Link css={titleLinkCss} to=\"/room/new\">\n        {t('addRoomLink')}\n      </Link>\n    </Title>\n    <FirestoreCollection\n      path={'publicRoomListings'}\n      render={({ isLoading, data }) => {\n        return isLoading ? <Loader /> : <List>{data.map(RoomListItem)}</List>;\n      }}\n      sort=\"sortKey\"\n    />\n  </Fragment>\n);\n\nexport default ListRooms;\n","import React, { useContext } from 'react';\nimport firebase from '@firebase/app';\nimport { FirestoreCollection } from 'react-firestore';\nimport { Redirect, useParams } from 'react-router-dom';\n\nimport RoomAuthContext from '../contexts/RoomAuth';\nimport Loader from '../components/Loader';\n\n// Fetches the room based on the current `id` and `password` params.\n// If the stored `id` and `password` don't match a room, redirect to the password prompt.\n// If they do match, render the given component with a `room` prop that contains the room document.\nconst withAuthorizedRoom = Component => props => {\n  const { getRoomAuth } = useContext(RoomAuthContext);\n  const { id: roomId } = useParams();\n  const { id: currentId, password: currentPassword } = getRoomAuth();\n\n  const redirect = <Redirect to={`/room/${roomId}/join`} />;\n\n  if (roomId !== currentId) {\n    return redirect;\n  }\n\n  return (\n    <FirestoreCollection\n      filter={[\n        [firebase.firestore.FieldPath.documentId(), '==', currentId],\n        ['password', '==', currentPassword],\n      ]}\n      path={'rooms'}\n      render={({ isLoading, data }) => {\n        if (isLoading) {\n          return <Loader />;\n        }\n\n        if (!data.length) {\n          return redirect;\n        }\n\n        return <Component room={data[0]} {...props} />;\n      }}\n    />\n  );\n};\n\nexport default withAuthorizedRoom;\n","import React from 'react';\n\n// Unescapes HTML character entities.\n// WARNING: This is vunerable to XSS attacks!\nconst Unescape = ({ children }) => (\n  <span dangerouslySetInnerHTML={{ __html: children }} />\n);\n\nexport default Unescape;\n","import { createContext } from 'react';\n\nconst KEY = 'favoriteSongs';\n// When the page first loads, fetch the existing favorites from localStorage.\n// As long as the object is saved each time a song is added or removed,\n// the objects will remain in sync.\nconst songs = JSON.parse(localStorage.getItem(KEY)) || {};\n\nconst saveSongs = obj => localStorage.setItem(KEY, JSON.stringify(obj));\n\n// Add a song to the user's favorites.\nconst addSong = (ytId, title) => {\n  songs[ytId] = title;\n  saveSongs(songs);\n};\n\n// Remove a song from the user's favorites.\nconst removeSong = ytId => {\n  delete songs[ytId];\n  saveSongs(songs);\n};\n\n// Return true if a song is in the user's favorites.\nconst hasSong = ytId => {\n  return !!songs[ytId];\n};\n\n// Return the user's total number of favorites.\nconst songCount = () => Object.keys(songs).length;\n\n// Map through each song. Used to render a list of favorites, for example.\nconst mapSongs = fn =>\n  Object.keys(songs).map((ytId, index) => fn(ytId, songs[ytId], index));\n\n// As a safety measure, the entire `songs` object is NEVER exposed outside of this file.\n// This prevents the object from accidentally getting mutated.\nconst FavoriteSongs = createContext({\n  addSong,\n  removeSong,\n  hasSong,\n  mapSongs,\n  songCount,\n});\n\nexport default FavoriteSongs;\n","/** @jsx jsx */\n\nimport { useContext, useState } from 'react';\nimport { css, jsx } from '@emotion/core';\nimport { MdFavoriteBorder, MdFavorite } from 'react-icons/md';\n\nimport FavoriteSongsContext from '../contexts/FavoriteSongs';\nimport { commonButtonMixin } from '../styles';\n\nconst divCss = css`\n  padding: 7px 12px;\n  display: flex;\n  align-items: center;\n`;\n\nconst buttonCss = css`\n  ${commonButtonMixin}\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 3px;\n  border-radius: 6px;\n  background: transparent;\n  color: #fff;\n  font-size: 24px;\n  line-height: 1;\n`;\n\nconst FavoriteToggle = ({ ytId, title }) => {\n  const { addSong, removeSong, hasSong } = useContext(FavoriteSongsContext);\n  const [isFav, setIsFav] = useState(hasSong(ytId));\n\n  const onClick = () => {\n    if (isFav) {\n      removeSong(ytId);\n    } else {\n      addSong(ytId, title);\n    }\n    setIsFav(!isFav);\n  };\n\n  return (\n    <div css={divCss}>\n      <button css={buttonCss} onClick={onClick}>\n        {isFav ? (\n          <MdFavorite color=\"#ff4dc7\" />\n        ) : (\n          <MdFavoriteBorder color=\"#aaa\" />\n        )}\n      </button>\n    </div>\n  );\n};\n\nexport default FavoriteToggle;\n","/** @jsx jsx */\n\nimport { css, jsx } from '@emotion/core';\n\nimport { HD_VIDEO_RATIO } from '../utils/constants';\nimport { listBorder } from '../styles';\n\nconst imgCss = css`\n  object-fit: cover;\n  flex-shrink: 0;\n  outline: ${listBorder};\n`;\n\nconst YouTubeThumbnail = ({ ytId, width }) => {\n  const url = `https://i.ytimg.com/vi/${ytId}/hqdefault.jpg`;\n  return (\n    <img\n      alt=\"\"\n      aria-hidden=\"true\"\n      css={imgCss}\n      height={width * HD_VIDEO_RATIO}\n      src={url}\n      width={width}\n    />\n  );\n};\n\nYouTubeThumbnail.defaultProps = {\n  width: 100,\n};\n\nexport default YouTubeThumbnail;\n","const HD_VIDEO_RATIO = 9 / 16;\n\nexport { HD_VIDEO_RATIO };\n","/** @jsx jsx */\n\nimport { css, jsx } from '@emotion/core';\n\nimport Unescape from './Unescape';\nimport FavoriteToggle from './FavoriteToggle';\nimport YouTubeThumbnail from './YouTubeThumbnail';\nimport { listItemMixin } from '../styles';\nimport t from '../utils/translate';\n\nconst liCss = css`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding: 10px 0 10px 15px;\n  box-sizing: border-box;\n  max-width: 100vw;\n  overflow: hidden;\n  ${listItemMixin('130px', '11px')}\n`;\n\nconst numberCss = css`\n  position: absolute;\n  left: 0;\n  top: 0;\n  display: block;\n  padding: 10px 10px 7px 15px;\n  border-bottom-right-radius: 5px;\n  font-size: 14px;\n  font-weight: bold;\n  background: #000;\n  line-height: 1;\n  color: #bbb;\n`;\n\nconst textContainerCss = css`\n  flex: 1 0;\n  color: #fff;\n  font-size: 13px;\n  padding: 0 0 0 15px;\n  line-height: 1.5;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n`;\n\nconst SongListItem = ({ singer, title, ytId, index }) => (\n  <li css={liCss}>\n    <span css={numberCss}>{index === 0 ? t('next') : index + 1}</span>\n    <YouTubeThumbnail ytId={ytId} />\n    <span css={textContainerCss}>\n      <Unescape>{title}</Unescape>\n      <br />\n      <strong>{singer}</strong>\n    </span>\n    <FavoriteToggle title={title} ytId={ytId} />\n  </li>\n);\n\nexport default SongListItem;\n","import React from 'react';\nimport { FirestoreCollection } from 'react-firestore';\nimport Loader from './Loader';\nimport SongListItem from './SongListItem';\nimport withAuthorizedRoom from './withAuthorizedRoom';\nimport List from './List';\nimport t from '../utils/translate';\n\nconst SongList = ({ roomId }) => {\n  return (\n    <FirestoreCollection\n      path={`rooms/${roomId}/songs`}\n      render={({ isLoading, data }) => {\n        return isLoading ? (\n          <Loader />\n        ) : data.length ? (\n          <List>\n            {data.map((props, index) => (\n              <SongListItem {...props} index={index} key={props.id} />\n            ))}\n          </List>\n        ) : (\n          <p>{t('songsEmptySet')}</p>\n        );\n      }}\n      sort=\"created\"\n    />\n  );\n};\nexport default withAuthorizedRoom(SongList);\n","/** @jsx jsx */\n\nimport { css, jsx } from '@emotion/core';\nimport { withFirestore } from 'react-firestore';\nimport { MdFastForward, MdPause, MdPlayArrow } from 'react-icons/md';\n\nimport t from '../utils/translate';\nimport { commonButtonMixin } from '../styles';\n\nconst containerCss = css`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 50px 20px;\n`;\n\nconst buttonCss = css`\n  background: #222;\n  display: block;\n  padding: 10px;\n  margin: 0;\n  font-size: 40px;\n  height: 60px;\n  width: 60px;\n  line-height: 40px;\n  border-radius: 30px;\n  ${commonButtonMixin}\n\n  & + & {\n    margin-left: 20px;\n  }\n`;\n\nconst RoomControls = ({ firestore, roomId }) => {\n  const onClick = command => event => {\n    event.preventDefault();\n    const collection = firestore.collection(`rooms/${roomId}/commands`);\n    collection.get().then(snapshot => {\n      snapshot.docs.map(({ id }) => collection.doc(id).delete());\n      collection.add({\n        key: command,\n        created: Date.now(),\n      });\n    });\n  };\n\n  return (\n    <div css={containerCss}>\n      <button\n        css={buttonCss}\n        onClick={onClick('PLAY')}\n        title={t('play')}\n        type=\"button\"\n      >\n        <span aria-hidden=\"true\">\n          <MdPlayArrow color=\"#fff\" />\n        </span>\n      </button>\n      <button\n        css={buttonCss}\n        onClick={onClick('PAUSE')}\n        title={t('pause')}\n        type=\"button\"\n      >\n        <span aria-hidden=\"true\">\n          <MdPause color=\"#fff\" />\n        </span>\n      </button>\n      <button\n        css={buttonCss}\n        onClick={onClick('NEXT_SONG')}\n        title={t('nextSong')}\n        type=\"button\"\n      >\n        <span aria-hidden=\"true\">\n          <MdFastForward color=\"#fff\" />\n        </span>\n      </button>\n    </div>\n  );\n};\n\nexport default withFirestore(RoomControls);\n","/** @jsx jsx */\n\nimport { Fragment } from 'react';\nimport { jsx } from '@emotion/core';\n\nimport withAuthorizedRoom from '../components/withAuthorizedRoom';\nimport SongList from '../components/SongList';\nimport Title from '../components/Title';\nimport RoomControls from '../components/RoomControls';\nimport { Link } from 'react-router-dom';\nimport t from '../utils/translate';\nimport { titleLinkCss } from '../styles';\n\nconst ViewRoom = ({ room: { id, name } }) => (\n  <Fragment>\n    <Title text={name}>\n      <Link css={titleLinkCss} to={`/room/${id}/song/search`}>\n        {t('roomAddSong')}\n      </Link>\n    </Title>\n    <SongList roomId={id} />\n    <RoomControls roomId={id} />\n    <p>\n      <Link to={`/room/${id}/play`}>{t('roomTvView')}</Link>\n    </p>\n  </Fragment>\n);\n\nexport default withAuthorizedRoom(ViewRoom);\n","/** @jsx jsx */\n\nimport { useContext } from 'react';\nimport { withFirestore } from 'react-firestore';\nimport { css, jsx } from '@emotion/core';\nimport { useParams, useHistory } from 'react-router-dom';\n\nimport RoomAuthContext from '../contexts/RoomAuth';\nimport Unescape from './Unescape';\nimport YouTubeThumbnail from './YouTubeThumbnail';\nimport FavoriteToggle from './FavoriteToggle';\nimport { commonButtonMixin, listItemMixin } from '../styles';\n\nconst liCss = css`\n  display: flex;\n  flex-direction: row;\n  ${listItemMixin('130px')}\n`;\n\nconst buttonCss = css`\n  ${commonButtonMixin}\n  background: transparent;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  text-align: left;\n  padding: 10px 0 10px 15px;\n  flex: 1 0;\n`;\n\nconst spanCss = css`\n  color: #fff;\n  font-size: 13px;\n  padding: 0 15px;\n  line-height: 1.5;\n`;\n\nconst SongSearchListItem = ({ firestore, ytId, title }) => {\n  const { getRoomAuth } = useContext(RoomAuthContext);\n  const { id: roomId } = useParams();\n  const history = useHistory();\n\n  const onClick = e => {\n    e.preventDefault();\n    firestore.collection(`rooms/${roomId}/songs`).add({\n      singer: getRoomAuth().name,\n      ytId,\n      created: Date.now(),\n      title,\n    });\n    history.push(`/room/${roomId}`);\n  };\n\n  // YouTube's `hqdefault` images always display in 4:3 aspect ratio with black bars\n  // padding the space if the video is in a different aspect ratio.\n  // To hide those bars on the top and bottom of images,\n  // Here, we force the thumbnails to display in HD aspect ratio (16:9) and use the\n  // `object-fit` CSS property to center the image and maintain it's proprotions.\n  return (\n    <li css={liCss}>\n      <button css={buttonCss} onClick={onClick}>\n        <YouTubeThumbnail ytId={ytId} />\n        <span css={spanCss}>\n          <Unescape>{title}</Unescape>\n        </span>\n      </button>\n      <FavoriteToggle title={title} ytId={ytId} />\n    </li>\n  );\n};\n\nexport default withFirestore(SongSearchListItem);\n","import React from 'react';\nimport { connect } from 'react-refetch';\n\nimport Loader from './Loader';\nimport SongSearchListItem from './SongSearchListItem';\nimport List from './List';\nimport getSecret from '../utils/getSecret';\n\nconst SongSearchList = ({ resultsFetch }) => {\n  if (resultsFetch) {\n    const { pending, rejected, fulfilled, value } = resultsFetch;\n\n    // If the request is ongoing, display the loading indicator.\n    if (pending) {\n      return <Loader />;\n      // Display an error message if the request has failed.\n    } else if (rejected) {\n      return <p>oh noes</p>;\n      // If the request has succeeded and has results, display the search results.\n    } else if (fulfilled && value.items && value.items.length) {\n      return (\n        <List>\n          {value.items.map(({ id: { videoId }, snippet: { title } }) => {\n            return (\n              <SongSearchListItem key={videoId} title={title} ytId={videoId} />\n            );\n          })}\n        </List>\n      );\n    }\n  }\n  return null;\n};\n\n// Return different react-refetch configs depending on the current search query.\n// If the search query is empty, return an empty result instead of making a request.\nconst buildFetchRequest = query => {\n  const trimmedQuery = query.trim();\n  if (trimmedQuery) {\n    const escapedQuery = encodeURI(`karaoke ${trimmedQuery}`);\n    const apiKey = getSecret('youtubeApiKey');\n    // If react-refetch receives an object with `{ url, headers, etc }`\n    // then it will make that HTTP request.\n    return {\n      url: `https://www.googleapis.com/youtube/v3/search?q=${escapedQuery}&key=${apiKey}&type=video&part=snippet&videoEmbeddable=true&maxResults=50`,\n      headers: {\n        Accept: 'application/json',\n      },\n    };\n  }\n  // If react-refetch receives an object with `{ value }`\n  // then it will return that value instead of making a request.\n  return {\n    value: {\n      items: [],\n    },\n  };\n};\n\n// This will add a `resultsFetch` prop to the SongSearchList component,\n// with `pending`, `rejected`, and `fulfilled` booleans to know the state of the request\n// and a `value` that is the result of the successful request.\nexport default connect(({ query }) => ({\n  resultsFetch: buildFetchRequest(query),\n}))(SongSearchList);\n","import React, { useState, useRef, useEffect } from 'react';\n\nimport SongSearchResults from '../components/SongSearchResults';\nimport t from '../utils/translate';\n\nconst SearchSongs = () => {\n  const inputRef = useRef(null);\n  const [query, setQuery] = useState('');\n  const [submittedQuery, setSubmittedQuery] = useState(query);\n\n  const onSubmit = e => {\n    e.preventDefault();\n    setSubmittedQuery(query);\n  };\n\n  const onChange = e => {\n    setQuery(e.target.value);\n  };\n\n  useEffect(() => {\n    const { current: input } = inputRef;\n    if (input) {\n      input.focus();\n    }\n  }, [inputRef]);\n\n  return (\n    <>\n      <form onSubmit={onSubmit}>\n        <label>\n          <span>{t('searchLabel')}</span>\n          <input\n            onChange={onChange}\n            ref={inputRef}\n            type=\"search\"\n            value={query}\n          />\n        </label>\n        <button>{t('searchButton')}</button>\n      </form>\n      <SongSearchResults query={submittedQuery} />\n    </>\n  );\n};\n\nexport default SearchSongs;\n","import React, { useContext } from 'react';\n\nimport FavoriteSongsContext from '../contexts/FavoriteSongs';\nimport SongSearchListItem from '../components/SongSearchListItem';\nimport List from '../components/List';\nimport t from '../utils/translate';\n\nconst FavoriteSongs = () => {\n  const { songCount, mapSongs } = useContext(FavoriteSongsContext);\n  return (\n    <>\n      {songCount() ? (\n        <List>\n          {mapSongs((ytId, title) => (\n            <SongSearchListItem key={ytId} title={title} ytId={ytId} />\n          ))}\n        </List>\n      ) : (\n        <p>{t('favoritesEmpty')}</p>\n      )}\n    </>\n  );\n};\n\nexport default FavoriteSongs;\n","/** @jsx jsx */\n\nimport { css, jsx } from '@emotion/core';\nimport { Link, useRouteMatch } from 'react-router-dom';\nimport { commonButtonMixin } from '../styles';\n\nconst mainColor = '#07c';\n\nconst listCss = css`\n  display: flex;\n  margin: 0;\n  padding: 0;\n  display: flex;\n  list-style-type: none;\n  margin: 0 15px 20px 15px;\n  border: 1px solid ${mainColor};\n  border-radius: 6px;\n  overflow: hidden;\n`;\n\nconst listItemCss = css`\n  display: block;\n  flex: 1 0;\n\n  & + & {\n    border-left: 1px solid ${mainColor};\n  }\n`;\n\nconst linkCss = css`\n  text-decoration: none;\n  display: block;\n  text-align: center;\n  font-weight: 600;\n  padding: 7px;\n  color: #fff;\n`;\n\nconst notCurrentLinkCss = css`\n  ${linkCss}\n  ${commonButtonMixin}\n`;\n\nconst currentLinkCss = css`\n  ${linkCss}\n  background: ${mainColor};\n`;\n\nconst Segment = ({ path, label }) => {\n  const isMatch = useRouteMatch({ path, exact: true });\n  return isMatch ? (\n    <span css={currentLinkCss}>{label}</span>\n  ) : (\n    <Link css={notCurrentLinkCss} to={path}>\n      {label}\n    </Link>\n  );\n};\n\nconst LinkSegmentControl = ({ routes }) => {\n  return (\n    <ul css={listCss}>\n      {routes.map(props => (\n        <li css={listItemCss} key={props.path}>\n          <Segment {...props} />\n        </li>\n      ))}\n    </ul>\n  );\n};\n\nexport default LinkSegmentControl;\n","/** @jsx jsx */\n\nimport { jsx } from '@emotion/core';\nimport { Fragment } from 'react';\nimport { Switch, Route, Link } from 'react-router-dom';\n\nimport SearchSongs from './SearchSongs';\nimport FavoriteSongs from './FavoriteSongs';\nimport Title from '../components/Title';\nimport LinkSegmentControl from '../components/LinkSegmentControl';\nimport withAuthorizedRoom from '../components/withAuthorizedRoom';\nimport t from '../utils/translate';\nimport { titleLinkCancelCss } from '../styles';\n\nconst routes = [\n  {\n    Component: SearchSongs,\n    path: `/room/:id/song/search`,\n  },\n  {\n    Component: FavoriteSongs,\n    path: `/room/:id/song/faves`,\n  },\n];\n\nconst AddSong = ({ room: { id: roomId } }) => {\n  return (\n    <Fragment>\n      <Title text={t('addSongTitle')}>\n        <Link css={titleLinkCancelCss} to={`/room/${roomId}`}>\n          {t('cancel')}\n        </Link>\n      </Title>\n\n      <LinkSegmentControl\n        routes={[\n          {\n            path: `/room/${roomId}/song/search`,\n            label: t('searchLink'),\n          },\n          {\n            path: `/room/${roomId}/song/faves`,\n            label: t('favoritesLink'),\n          },\n        ]}\n      />\n\n      <Switch>\n        {routes.map(({ Component, path }) => (\n          <Route exact={true} key={path} path={path}>\n            <Component />\n          </Route>\n        ))}\n      </Switch>\n    </Fragment>\n  );\n};\n\nexport default withAuthorizedRoom(AddSong);\n","import { useState, useEffect, useCallback } from 'react';\n\n// Informs child components of whether or not the mouse has recently moved.\n//\n// The bounceDuration represents the amount of time during which\n// the mouse must not move before this component informs its children\n// that mouseDidMove is false. Whenever the mouse moves, the bounceTimeout\n// is cancelled and restarted.\n//\n// The sleepDuration represents the amount of time that must pass after\n// a mouse event before this component will listen for other mouse events.\n// This is to increase performance by reducing the number of times that\n// this component updates and re-renders its children.\n\nconst OnMouseMove = ({ bounceDuration, children, sleepDuration }) => {\n  const [didMove, setDidMove] = useState(false);\n  const [bounceTimeout, setBounceTimeout] = useState(null);\n  const [isSleeping, setIsSleeping] = useState(false);\n\n  const onMove = useCallback(() => {\n    // If currently sleeping, ignore this mouse event and do nothing.\n    if (isSleeping) {\n      return;\n    }\n\n    // If not sleeping, sleep after this event.\n    setIsSleeping(true);\n    setTimeout(() => setIsSleeping(false), sleepDuration);\n\n    // \"Bounce\" the time until didMove is set to false by cancelling the\n    // current bounceTimeout and replacing it with a new timeout.\n    setDidMove(true);\n    clearTimeout(bounceTimeout);\n    setBounceTimeout(setTimeout(() => setDidMove(false), bounceDuration));\n  }, [sleepDuration, isSleeping, bounceTimeout, bounceDuration]);\n\n  useEffect(() => {\n    window.addEventListener('mousemove', onMove);\n    return () => window.removeEventListener('mousemove', onMove);\n  }, [onMove]);\n\n  return children(didMove);\n};\n\nOnMouseMove.defaultProps = {\n  bounceDuration: 1000,\n  sleepDuration: 200,\n};\n\nexport default OnMouseMove;\n","import React from 'react';\n\nconst ProgressCircle = ({\n  percent,\n  radius,\n  strokeWidth,\n  secondaryColor,\n  primaryColor,\n}) => {\n  const diameter = radius * 2;\n  const perimeter = diameter * Math.PI;\n  return (\n    <div\n      style={{\n        width: diameter,\n        height: diameter,\n        transform: `rotate(-90deg)`,\n      }}\n    >\n      <svg\n        height={diameter}\n        viewBox={`0 0 ${diameter} ${diameter}`}\n        width={diameter}\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <circle\n          cx={radius}\n          cy={radius}\n          fill=\"none\"\n          r={radius - strokeWidth / 2}\n          stroke={secondaryColor}\n          strokeWidth={strokeWidth}\n        />\n        <circle\n          cx={radius}\n          cy={radius}\n          fill=\"none\"\n          r={radius - strokeWidth / 2}\n          stroke={primaryColor}\n          strokeDasharray={perimeter}\n          strokeWidth={strokeWidth}\n          style={{\n            strokeDashoffset: perimeter - perimeter * Math.min(1, percent),\n            transition: 'stroke-dashoffset 0.3s',\n          }}\n        />\n      </svg>\n    </div>\n  );\n};\n\nProgressCircle.defaultProps = {\n  radius: 50,\n  strokeWidth: 4,\n  secondaryColor: '#444',\n  primaryColor: '#fff',\n};\n\nexport default ProgressCircle;\n","import { Machine, assign, sendParent } from 'xstate';\n\n// This machine represents a timer that can be paused or unpaused.\n// When the timer reaches its limit, the machine transitions to its \"done\" state,\n// a final state that indicates the segue has completed.\nconst CONFIG = {\n  id: 'segue',\n  initial: 'playing',\n  context: {\n    limit: 10000, // The duration of the segue (ten seconds)\n    elapsed: 0, // The amount of time that has elapsed since the segue began.\n    stepDate: null, // The time that the last \"tick\" was measured.\n  },\n  states: {\n    // The \"playing\" state represents the unpaused timer.\n    // Every 200 milliseconds it updates the time remaining in the segue\n    // by returning to the same state, triggering the same actions.\n    playing: {\n      entry: ['setStepDate', 'updateProgress'],\n      exit: 'incrementElapsed',\n      after: {\n        200: {\n          target: 'playing',\n        },\n      },\n      on: {\n        // If the time limit has been exceeded, immediately transition\n        // to the \"done\" state instead of waiting for the tick to end.\n        '': {\n          target: 'done',\n          cond: 'limitExceeded',\n        },\n        // If the segue receives a PAUSE event, it will call the\n        // `incrementElapsed` exit action just like if the tick had ended.\n        PAUSE: {\n          target: 'paused',\n        },\n      },\n    },\n    paused: {\n      on: {\n        PLAY: {\n          target: 'playing',\n        },\n      },\n    },\n    done: {\n      type: 'final',\n    },\n  },\n};\n\nexport default Machine(CONFIG, {\n  actions: {\n    // When beginning the 200ms tick, set the date at which the tick begins,\n    // and update the parent machine by sending a SEGUE_PROGRESS event.\n    setStepDate: assign({\n      stepDate: () => Date.now(),\n    }),\n\n    // At the end of the 200ms tick, compare the start date to the current date,\n    // and add that much time to the `elapsed` value.\n    // Dates are compared instead of assuming that exactly 200ms have passed,\n    // because JavaScript timeouts don't fire precisely when intended.\n    // This also accounts for when a segue is paused in the middle of a tick.\n    incrementElapsed: assign({\n      elapsed: ({ stepDate, elapsed }) => elapsed + (Date.now() - stepDate),\n    }),\n\n    // Update the parent machine with a SEGUE_PROGRESS event after each tick.\n    updateProgress: sendParent(({ limit, elapsed }) => ({\n      type: 'SEGUE_PROGRESS',\n      percent: elapsed / limit,\n    })),\n  },\n\n  guards: {\n    limitExceeded: ({ limit, elapsed }) => elapsed >= limit,\n  },\n});\n","import { Machine } from 'xstate';\n\n// This machine represents an actively playing or paused video.\nconst CONFIG = {\n  id: 'video',\n  initial: 'start',\n  context: {\n    player: null,\n  },\n  states: {\n    // When the video machine is initialized, begin playing the video.\n    start: {\n      on: {\n        '': {\n          target: 'buffering',\n          actions: 'playVideo',\n        },\n      },\n    },\n\n    // The \"buffering\" state only exists during the very first time a\n    // video is being buffered by YouTube. By having its own named state,\n    // the segue can continue to be show until the video is done buffering.\n    buffering: {\n      on: {\n        PLAYER_PLAYING: {\n          target: 'playing',\n        },\n      },\n    },\n\n    // While playing, the video may be paused.\n    playing: {\n      on: {\n        // PAUSE events are manually triggered by our UI.\n        PAUSE: {\n          actions: 'pauseVideo',\n        },\n        // PLAYER_PAUSED events are sent by the YouTube player.\n        PLAYER_PAUSED: {\n          target: 'paused',\n        },\n      },\n    },\n\n    // While paused, the video may be played.\n    paused: {\n      on: {\n        // PLAY events are manually triggered by our UI.\n        PLAY: {\n          actions: 'playVideo',\n        },\n        // PLAYER_PLAYING events are sent by the YouTube player.\n        PLAYER_PLAYING: {\n          target: 'playing',\n        },\n      },\n    },\n  },\n};\n\nexport default Machine(CONFIG, {\n  // Send play and pause commands to the player.\n  // The player will then send PLAYER_PLAYING or PLAYER_PAUSED events,\n  // which are used to update the state of this machine.\n  actions: {\n    playVideo: ({ player }) => player.playVideo(),\n    pauseVideo: ({ player }) => player.pauseVideo(),\n  },\n});\n","export default snapshot =>\n  snapshot.docs.map(doc => ({\n    id: doc.id,\n    ...doc.data(),\n  }));\n","const STATES = {\n  [-1]: 'PLAYER_LOADING',\n  0: 'PLAYER_ENDED',\n  1: 'PLAYER_PLAYING',\n  2: 'PLAYER_PAUSED',\n  3: 'PLAYER_BUFFERING',\n  5: 'PLAYER_CUED',\n};\n\n// This service does nothing until it recieves a READY event with\n// a reference to the YouTube player. Then it will listen to events\n// from the player and pass those to the parent machine.\nexport default () => (sendParent, onEvent) => {\n  const onStateChange = ({ data }) => sendParent(STATES[data]);\n  const onError = () => sendParent('PLAYER_ERROR');\n\n  onEvent(({ type, player }) => {\n    if (type === 'READY') {\n      player.addEventListener('onStateChange', onStateChange);\n      player.addEventListener('onError', onError);\n    }\n  });\n};\n","import parseQuerySnapshot from '../utils/parseQuerySnapshot';\n\nexport default query => () => sendParent => {\n  const update = snapshot => {\n    const commands = parseQuerySnapshot(snapshot);\n    if (commands.length) {\n      sendParent(commands[0].key);\n    }\n  };\n\n  query.get().then(update);\n  return query.onSnapshot(update);\n};\n","import { Machine, assign, forwardTo } from 'xstate';\n\nimport segueMachine from './segue';\nimport videoMachine from './video';\nimport songsService from './songs';\nimport playerService from './player';\nimport commandsService from './commands';\n\nconst CONFIG = {\n  id: 'karaoke',\n  initial: 'loading',\n  context: {\n    songs: [], // The queue of songs waiting to be played.\n    currentSong: null, // The current songs being played.\n    player: null, // The YouTube iframe player.\n    segueProgress: 0, // How complete the current segue is, from 0 to 1.\n  },\n  states: {\n    // The machine begins in the \"loading\" state until the YouTube player has\n    // downloaded and is ready to play a video. When the player is ready, it\n    // should sent a READY event to this machine with a reference to the player.\n    loading: {\n      on: {\n        READY: {\n          actions: [\n            // After receiving the player reference from the event,\n            // save it to the context so that it can be passed to other machines.\n            assign({ player: (_, { player }) => player }),\n            // Forward this event to the player service so that it can send\n            // events to this machine whenever the player state changes.\n            forwardTo('player'),\n          ],\n          target: 'next',\n        },\n      },\n    },\n\n    // The \"segue\" state represents a pause between videos.\n    // This pause can be used to display information about the next song,\n    // such as who as singing it. The segue is its own machine.\n    segue: {\n      invoke: {\n        src: 'segue',\n        // When the segue completes, begin playing the video.\n        onDone: {\n          target: 'video',\n        },\n      },\n      on: {\n        // While in the \"segue\" state, PLAY and PAUSE events are sent to the segue.\n        PAUSE: {\n          actions: forwardTo('segue'),\n        },\n        PLAY: {\n          actions: forwardTo('segue'),\n        },\n        // Allow skipping to the next song in the queue.\n        NEXT_SONG: {\n          target: 'next',\n        },\n        // The segue machine sends SEGUE_PROGRESS events to this parent machine,\n        // with a percent of how much time remains in the segue.\n        // This is because the useMachine() hook will only re-render\n        // when events are sent to this machine, and we want the component to\n        // re-render to update the progress meter of time remaining.\n        SEGUE_PROGRESS: {\n          actions: assign({ segueProgress: (_, { percent }) => percent }),\n        },\n      },\n    },\n\n    // The \"video\" state represents the actively playing or paused video,\n    // and is a separate machine.\n    video: {\n      invoke: {\n        src: 'video',\n        data: {\n          player: ({ player }) => player,\n        },\n      },\n      on: {\n        // Allow skipping to the next song in the queue.\n        NEXT_SONG: {\n          target: 'next',\n        },\n        // While in the \"video\" state, PLAY and PAUSE events are sent to the segue.\n        PAUSE: {\n          actions: forwardTo('video'),\n        },\n        PLAY: {\n          actions: forwardTo('video'),\n        },\n        // When the player indicates that the current video has finished,\n        // exit this state and begin the segue of the next video.\n        PLAYER_ENDED: {\n          target: 'next',\n        },\n        // If the player encounters an error,\n        // immediately begin the segue of the next video.\n        PLAYER_ERROR: {\n          target: 'next',\n        },\n        // Forward YouTube playing and paused events to the video machine\n        // so that it can update its state.\n        PLAYER_PLAYING: {\n          actions: forwardTo('video'),\n        },\n        PLAYER_PAUSED: {\n          actions: forwardTo('video'),\n        },\n        PLAYER_BUFFERING: {\n          actions: forwardTo('video'),\n        },\n      },\n    },\n\n    // The \"next\" state immediate resolves to the \"segue\" state if there are\n    // any songs left in the queue, or the \"empty\" state if no songs remain.\n    next: {\n      entry: 'shiftSong',\n      on: {\n        '': [\n          {\n            target: 'segue',\n            cond: ({ currentSong }) => !!currentSong,\n            // As soon as the segue begins, the next video is loaded into the player.\n            actions: 'cueVideo',\n          },\n          {\n            target: 'empty',\n            actions: 'clearVideo',\n          },\n        ],\n      },\n    },\n\n    // Tne \"empty\" state represents an empty playlist with zero songs.\n    // Rather than remain permanently in this state, the machine transitions\n    // to the \"next\" state after one second to check if any songs were added.\n    // If there are still no songs, the machine will return to this \"empty\" state.\n    empty: {\n      after: {\n        1000: {\n          target: 'next',\n        },\n      },\n    },\n\n    // Moving this machine to a final state should cause any invoked\n    // machines to call their cleanup callbacks. This state should\n    // only be entered when leaving the DisplayRoom route.\n    done: {\n      type: 'final',\n    },\n  },\n\n  invoke: [\n    // This service listens to Firebase for songs added to this room.\n    // When songs are added or removed, this service sends the UPDATE_SONGS event\n    // to instruct this machine to update its songs list.\n    {\n      src: 'songs',\n    },\n\n    {\n      src: 'commands',\n    },\n\n    // This service represents the YouTube iframe player.\n    // It sends events to this machine whenevr the player's state changes.\n    {\n      src: 'player',\n    },\n  ],\n\n  on: {\n    // When songs are added or removed from Firebase, the songs service will\n    //send the UPDATE_SONGS event. Store the new list of songs in the context.\n    UPDATE_SONGS: {\n      actions: assign({ songs: (_, { songs }) => songs }),\n    },\n    DONE: {\n      target: 'done',\n    },\n  },\n};\n\nconst playerMachine = (firestore, roomId) => {\n  const songCollection = firestore.collection(`rooms/${roomId}/songs`);\n  const songQuery = songCollection.orderBy('created');\n  const commandCollection = firestore.collection(`rooms/${roomId}/commands`);\n  const commandQuery = commandCollection.orderBy('created');\n\n  return Machine(CONFIG, {\n    actions: {\n      // Takes the first song in the queue and sets it to the current song.\n      // Then update Firebase with the current song deleted from the queue.\n      shiftSong: assign({\n        currentSong: ({ songs }) => {\n          const nextSong = songs.shift();\n          if (nextSong && nextSong.id) {\n            songCollection.doc(nextSong.id).delete();\n          }\n          return nextSong;\n        },\n      }),\n\n      // Load the current song into the YouTube player.\n      cueVideo: ({ player, currentSong }) => {\n        player.cueVideoById(currentSong.ytId);\n      },\n\n      // If the queue is empty, clear the current video by\n      // attempting to load a video with a blank ID.\n      clearVideo: ({ player }) => {\n        if (player.getVideoData().title !== '') {\n          player.cueVideoById('');\n        }\n      },\n    },\n\n    services: {\n      segue: segueMachine,\n      video: videoMachine,\n      songs: songsService(songQuery),\n      player: playerService,\n      commands: commandsService(commandQuery),\n    },\n  });\n};\n\nexport default playerMachine;\n","import parseQuerySnapshot from '../utils/parseQuerySnapshot';\n\n// Whenever the Firebase selection of songs changes,\n// this services sends an UPDATE_SONGS event to its parent,\n// with an array of the new queue of songs.\nexport default query => () => sendParent => {\n  const update = snapshot => {\n    sendParent({\n      type: 'UPDATE_SONGS',\n      songs: parseQuerySnapshot(snapshot),\n    });\n  };\n\n  query.get().then(update);\n\n  // onSnapshot() returns a function to stop listening for events.\n  // By returning that function from this service, this service can\n  // stop listening when the parent machine reaches a final state.\n  return query.onSnapshot(update);\n};\n","import React, { useEffect, useCallback } from 'react';\nimport { withFirestore } from 'react-firestore';\nimport { useMachine } from '@xstate/react';\nimport YouTube from 'react-youtube';\nimport { Link } from 'react-router-dom';\n\nimport Unescape from '../components/Unescape';\nimport OnMouseMove from '../components/OnMouseMove';\nimport ProgressCircle from '../components/ProgressCircle';\nimport withAuthorizedRoom from '../components/withAuthorizedRoom';\nimport karaokeMachine from '../services/karaoke';\nimport t from '../utils/translate';\n\nconst MARQUEE_HEIGHT = 50;\n\nconst styles = {\n  video: {\n    position: 'fixed',\n    top: 0,\n    bottom: MARQUEE_HEIGHT,\n    left: 0,\n    right: 0,\n  },\n  cover: {\n    position: 'absolute',\n    top: 0,\n    bottom: 0,\n    left: 0,\n    right: 0,\n  },\n  screen: {\n    position: 'fixed',\n    top: 0,\n    bottom: MARQUEE_HEIGHT,\n    left: 0,\n    right: 0,\n    background: '#000',\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    justifyContent: 'center',\n    color: '#fff',\n  },\n  segueSinger: {\n    fontWeight: 600,\n    fontSize: 80,\n    whiteSpace: 'nowrap',\n    paddingRight: 50,\n    paddingLeft: 50,\n    textOverflow: 'ellipsis',\n    textAlign: 'center',\n  },\n  segueSong: {\n    fontWeight: 400,\n    fontSize: 50,\n    padding: 50,\n    textAlign: 'center',\n  },\n  marquee: {\n    position: 'fixed',\n    bottom: 0,\n    left: 0,\n    right: 0,\n    height: MARQUEE_HEIGHT,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'flex-start',\n    overflow: 'hidden',\n    margin: 0,\n    padding: 0,\n    background: '#666',\n    listStyleType: 'none',\n    whiteSpace: 'nowrap',\n    fontSize: 30,\n    fontWeight: 600,\n    color: '#fff',\n  },\n  marqueeItem: {\n    marginLeft: 40,\n  },\n  progress: substate => ({\n    transition: 'transform 1s, opacity 1s',\n    transformOrigin: '50% 50%',\n    transform: `scale(${substate === 'buffering' ? 1.5 : 1})`,\n    opacity: substate === 'buffering' ? 0 : 1,\n  }),\n  controlPanel: isVisible => ({\n    position: 'fixed',\n    right: 0,\n    top: 0,\n    opacity: isVisible ? 1 : 0,\n    transition: 'opacity 0.5s',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'flex-start',\n  }),\n  button: {\n    border: 'none',\n    background: 'transparent',\n    padding: 0,\n    display: 'block',\n    marginTop: 10,\n    marginRight: 10,\n    fontSize: 60,\n    cursor: 'pointer',\n    textDecoration: 'none',\n    fontFamily: 'sans-serif',\n    outline: 'none',\n  },\n};\n\nconst iframeParams = {\n  controls: 0,\n  disablekb: 1,\n  enablejsapi: 1,\n  modestbranding: 1,\n};\n\nconst DisplayRoom = ({ firestore, room: { id: roomId } }) => {\n  const [current, send, service] = useMachine(\n    karaokeMachine(firestore, roomId)\n  );\n\n  const {\n    value: state,\n    context: { currentSong, songs, segueProgress },\n  } = current;\n\n  const submachine = service.children.get(state);\n  const substate = submachine && submachine.state.value;\n\n  const onKeyDown = useCallback(\n    ({ key }) => {\n      if (key === ' ') {\n        if (substate === 'playing') {\n          send('PAUSE');\n        } else if (substate === 'paused') {\n          send('PLAY');\n        }\n      } else if (key === 'ArrowRight') {\n        send('NEXT_SONG');\n      }\n    },\n    [send, substate]\n  );\n\n  useEffect(() => {\n    window.addEventListener('keydown', onKeyDown);\n    return () => {\n      window.removeEventListener('keydown', onKeyDown);\n    };\n  }, [onKeyDown]);\n\n  // When the component is de-rendered, send the 'DONE' event to the machine.\n  // This event should cause the machine to unsubscribe from any listeners.\n  useEffect(() => {\n    return () => {\n      send('DONE');\n    };\n  }, [send]);\n\n  return (\n    <>\n      <div style={styles.video}>\n        <YouTube\n          className=\"youtube\"\n          containerClassName=\"youtube\"\n          onReady={({ target }) => send({ type: 'READY', player: target })}\n          opts={iframeParams}\n        />\n      </div>\n\n      <ol style={styles.marquee}>\n        {songs.map(({ id, singer }, index) => (\n          <li key={id} style={styles.marqueeItem}>\n            {index === 0 ? 'Next' : index}: {singer}\n          </li>\n        ))}\n      </ol>\n\n      {(state === 'segue' || substate === 'buffering') && (\n        <div style={styles.screen}>\n          <div style={styles.segueSinger}>{currentSong.singer}</div>\n          <div style={styles.segueSong}>\n            <Unescape>{currentSong.title}</Unescape>\n          </div>\n          <div style={styles.progress(substate)}>\n            <ProgressCircle percent={segueProgress} />\n          </div>\n        </div>\n      )}\n\n      {state === 'empty' && (\n        <div style={styles.screen}>\n          <div style={styles.segueSong}>No Songs</div>\n        </div>\n      )}\n\n      {state === 'loading' && (\n        <div style={styles.screen}>\n          <div style={styles.segueSong}>Loading</div>\n        </div>\n      )}\n\n      <div\n        onClick={() => {}}\n        onKeyDown={() => {}}\n        role=\"presentation\"\n        style={styles.cover}\n      />\n\n      <OnMouseMove bounceDuration={2000}>\n        {didMove => (\n          <div style={styles.controlPanel(didMove)}>\n            {substate === 'paused' && (\n              <button\n                aria-label={t('play')}\n                onClick={() => send('PLAY')}\n                style={styles.button}\n                type=\"button\"\n              >\n                <span aria-hidden=\"true\"></span>\n              </button>\n            )}\n            {substate === 'playing' && (\n              <button\n                aria-label={t('pause')}\n                onClick={() => send('PAUSE')}\n                style={styles.button}\n                type=\"button\"\n              >\n                <span aria-hidden=\"true\"></span>\n              </button>\n            )}\n            <button\n              aria-label={t('nextSong')}\n              onClick={() => send('NEXT_SONG')}\n              style={styles.button}\n              type=\"button\"\n            >\n              <span aria-hidden=\"true\"></span>\n            </button>\n            <Link\n              aria-label={t('exitRoom')}\n              style={styles.button}\n              title={t('exitRoom')}\n              to={`/room/${roomId}`}\n            >\n              <span aria-hidden=\"true\"></span>\n            </Link>\n          </div>\n        )}\n      </OnMouseMove>\n    </>\n  );\n};\n\nexport default withFirestore(withAuthorizedRoom(DisplayRoom));\n","import CreateRoom from './CreateRoom';\nimport EditRoom from './EditRoom';\nimport JoinRoom from './JoinRoom';\nimport ListRooms from './ListRooms';\nimport ViewRoom from './ViewRoom';\nimport AddSong from './AddSong';\nimport DisplayRoom from './DisplayRoom';\n\nconst routes = [\n  { Component: ListRooms, path: '/', exact: true },\n  { Component: CreateRoom, path: '/room/new', exact: true },\n  { Component: JoinRoom, path: '/room/:id/join', exact: true },\n  { Component: ViewRoom, path: '/room/:id', exact: true },\n  { Component: DisplayRoom, path: '/room/:id/play', exact: true },\n  { Component: EditRoom, path: '/room/:id/edit', exact: true },\n  { Component: AddSong, path: '/room/:id/song', exact: false },\n];\n\nexport default routes;\n","/** @jsx jsx */\n\nimport { css, jsx } from '@emotion/core';\nimport { Link } from 'react-router-dom';\n\nimport { commonButtonMixin } from '../styles';\nimport t from '../utils/translate';\n\nconst textCss = css`\n  font-size: 14px;\n  font-weight: normal;\n  text-align: center;\n  margin: 0;\n  padding: 0;\n  display: block;\n`;\n\nconst linkCss = css`\n  ${commonButtonMixin}\n  color: #ddd;\n  text-decoration: none;\n  padding: 7px 15px;\n  background: #222;\n  display: block;\n`;\n\nconst Header = () => (\n  <header>\n    <h1 css={textCss}>\n      <Link css={linkCss} to=\"/\">\n        {t('appTitle')}\n      </Link>\n    </h1>\n  </header>\n);\n\nexport default Header;\n","import React from 'react';\nimport { BrowserRouter, Switch, Route } from 'react-router-dom';\nimport routes from './routes';\nimport Header from './components/Header';\n\nconst App = () => (\n  <BrowserRouter>\n    <Header />\n    <main style={{ background: '#000' }}>\n      <Switch>\n        {routes.map(({ Component, path, exact }) => (\n          <Route exact={exact} key={path} path={path}>\n            <Component />\n          </Route>\n        ))}\n      </Switch>\n    </main>\n  </BrowserRouter>\n);\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport firebase from '@firebase/app';\nimport '@firebase/firestore';\nimport '@firebase/auth';\nimport { FirestoreProvider } from 'react-firestore';\n\nimport getSecret from './utils/getSecret';\nimport App from './App';\n\nimport './index.scss';\n\nconst config = {\n  apiKey: getSecret('firebaseApiKey'),\n  projectId: getSecret('firebaseProjectId'),\n};\n\nfirebase.initializeApp(config);\nfirebase.auth().signInAnonymously();\n\nReactDOM.render(\n  <FirestoreProvider firebase={firebase}>\n    <App />\n  </FirestoreProvider>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}